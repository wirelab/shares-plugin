<script type="text/javascript" src="https://platform.twitter.com/widgets.js"></script>
<script type="text/javascript">
	/**
	 * Track shares in google analytics
	 */
	var trackShare = function(network) {
	  if (typeof ga !== "undefined" && ga !== null) {
	  	ga('send', 'event', network, 'share', window.location.protocol + '//' + window.location.hostname);
	    return ga('send', 'social', network, 'share', window.location.protocol + '//' + window.location.hostname);
	  }
	};

	/**
	 * Track whatsapp shares
	 */
	var whatsapp_available = navigator.userAgent.match(/Android|iPhone/i) && !navigator.userAgent.match(/iPod/i);
	if (whatsapp_available) {
      var whatsapp_shares = document.querySelectorAll('.shares-whatsapp');
	  for (var i = whatsapp_shares.length - 1; i >= 0; i--) {
	  	whatsapp_shares[i].style.display = '';
	  }
	  $('.shares-whatsapp').click(function(event) {
	    return trackShare("whatsapp");
	  });
	}

	/**
	 * Track twitter shares
	 */
	twttr.ready(function(twttr) {
	  var tweeted = function(intentEvent) {
	    if (!intentEvent) { return; }
	    return trackShare("twitter");
	  };
	  return twttr.events.bind('tweet', tweeted);
	});

	/**
	 * Track facebook shares
	 */
	var facebook_shares = document.querySelectorAll('.shares-linkedin');
	for (var i = facebook_shares.length - 1; i >= 0; i--) {
		facebook_shares[i].addEventListener('click', function(e){
        	var facebook_share = e.srcElement.dataset;
			var obj = {
			  method: 'share',
			  href: facebook_share.url
			};
			return FB.ui(obj, function(resp) { return trackShare("facebook"); });
		});
	}

	/**
	 * Open a popup for the linkedin shares
	 */
	var linkedin_shares = document.querySelectorAll('.shares-linkedin');
	for (var i = linkedin_shares.length - 1; i >= 0; i--) {
		linkedin_shares[i].addEventListener('click', function(e){
        	var linkedin_share = e.srcElement.dataset;
			window.open(
					'https://www.linkedin.com/shareArticle?mini=true&url=' + linkedin_share.url + '&title=' + linkedin_share.title + '&summary=' + linkedin_share.summary + '&source=' + linkedin_share.sitename,
					'title',
					'width=520,height=570,location=false'
			);
		});
	}
</script>